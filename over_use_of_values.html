<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>(Over)use of .values()</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="https://raw.githubusercontent.com/sindresorhus/github-markdown-css/gh-pages/github-markdown.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">(Over)use of <code>.values()</code></h1>
</div>
<p>Often in views, one can find code that looks like:</p>
<pre><code>def some_view(request):
    my_objects = MyModel.objects<b>.values()</b>
    return render(request, 'some_template.html', {'my_objects': my_objects})</code></pre>
<p>The <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#values"><strong><code>.values(…)</code></strong> [Django-doc]</a> part will return a (<code>QuerySet</code>) of <em>dictionaries</em>, not <code>MyModel</code> objects.</p>
<h1 id="why-is-it-a-problem">Why is it a problem?</h1>
<p>Dictionaries are less &quot;rich&quot;. These simply map keys to values. A model enhances that with several extra functionalities:</p>
<ol style="list-style-type: decimal">
<li>validation of fields;</li>
<li>mapping the field to its representation with <code>get_<i>fieldname</i>_display</code></li>
<li>properties added on the model;</li>
<li>retrieve related model objects (<code>ForeignKey</code>s act like lazy queries); and</li>
<li>updating, removing, etc. of the model to the database.</li>
</ol>
<h1 id="how-can-we-fix-this">How can we fix this?</h1>
<p>Do <em>not</em> make use of <code>.values(…)</code> unless in <em>certain</em> circumstances. One can make use of <code>.values(…)</code> for example to group by a certain value. But normally using <code>.values()</code> is not a good idea, one thus better creates a query that looks like:</p>
<pre><code>def some_view(request):
    my_objects = MyModel.objects.all()
    return render(request, 'some_template.html', {'my_objects': my_objects})</code></pre>
<h1 id="extra-tips">Extra tips</h1>
<p>Sometimes people make use of <strong><code>.values(…)</code></strong> to boost queries, by only selecting columns they are interested in. One can make use of <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#only"><strong><code>.only(…)</code></strong> [Django-doc]</a> and <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#defer"><strong><code>.defer(…)</code></strong> [Django-doc]</a> to retrieve only a subset of the columns of the model. The remaining columns are then <em>lazy</em> loaded with extra queries when necessary.</p>
</body>
</html>
